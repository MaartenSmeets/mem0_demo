sequenceDiagram
    participant User
    participant UI as NiceGUI UI
    participant Mem0
    participant Embedder as HF Embedder (CPU)
    participant Qdrant
    participant Neo4j
    participant Ollama as Ollama (OpenAI API)

    Note over User,Ollama: Request and Response
    User->>UI: Send message
    UI->>Mem0: search(text, user_id)
    Mem0->>Embedder: embed(query)
    Embedder-->>Mem0: vector
    Mem0->>Qdrant: similarity search
    Qdrant-->>Mem0: memories
    Mem0->>Neo4j: fetch relations
    Neo4j-->>Mem0: relations
    Mem0-->>UI: results + relations

    UI->>Ollama: Responses API (instructions + input + JSON schema)
    Ollama-->>UI: output_text
    UI->>User: Render response

    Note over User,Ollama: Memory Update
    UI->>Mem0: add(text, user_id)
    Mem0->>Ollama: extract facts and relations
    Ollama-->>Mem0: memory + graph directives
    Mem0->>Embedder: embed(memory)
    Embedder-->>Mem0: vector
    Mem0->>Qdrant: upsert memory
    Mem0->>Neo4j: write relations
    Mem0-->>UI: actions + graph actions
